import{r as l,G as T,j as e,S as V,C as v,u as $,v as f,f as i,M as x,B as N,k as B,m as G,n as d}from"./react-sWiKbk-Z.js";import{A as M}from"./AppLayout-BJnk0JD9.js";import"./inertia-Dgc5Zg7U.js";import"./axios-ngrFHoWO.js";import"./vendor-Z5AVMo_k.js";import"./app-DEFaNKxM.js";const J=({users:m,packages:k,sales:C})=>{const[n,u]=l.useState(1),[c,g]=l.useState(null),[s,h]=l.useState(null),[S,p]=l.useState(""),[_,y]=l.useState([]),{data:w,setData:o,post:U,processing:A,reset:E,errors:t,clearErrors:L}=T({user_id:"",plan_package_id:"",amount_credits:0}),R=a=>{const r=a.query.toLowerCase();r.trim().length?y(m.filter(b=>b.name.toLowerCase().startsWith(r)||b.email.toLowerCase().startsWith(r))):y([...m])},q=a=>{const r=a.value;g(r),o("user_id",r.id),u(2)},F=a=>{h(a),o(r=>({...r,plan_package_id:a.id.toString(),amount_credits:a.amount_credits}))},j=()=>{u(1),g(null),h(null),p(""),E(),L()},D=()=>{U("/vendedor/ventas/store/",{onSuccess:()=>{j()},preserveState:!0,preserveScroll:!0})},I=a=>new Date(a).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return e.jsxs(M,{children:[e.jsx(V,{title:"Venta"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 p-4 md:p-8",children:[e.jsx("div",{children:e.jsx(v,{className:"shadow-xl border border-gray-200 dark:border-gray-700 dark:bg-gray-800 transition-all duration-500",title:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:"Registrar Nueva Venta"}),e.jsxs("div",{className:"text-sm font-medium text-gray-500",children:["Paso ",n," de 2"]})]}),children:e.jsxs("div",{className:"p-2",children:[n===1&&e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsx("h3",{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Comencemos por encontrar al cliente"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"user-search",className:"mb-2 font-medium text-gray-600 dark:text-gray-400",children:"Buscar Cliente"}),e.jsx($,{value:S,suggestions:_,completeMethod:R,onSelect:q,onChange:a=>p(a.value),placeholder:"Escribe para buscar...",inputId:"user-search",inputClassName:"w-full",forceSelection:!0,dropdown:!0,field:"name",itemTemplate:a=>e.jsxs("div",{className:"flex items-center gap-3 p-2",children:[e.jsx(f,{label:a.name.charAt(0).toUpperCase(),shape:"circle",className:"bg-blue-500 text-white"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-800 dark:text-gray-200",children:a.name}),e.jsx("div",{className:"text-xs text-gray-500",children:a.email}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1 text-xs",children:[e.jsx(i,{severity:"info",value:`Créditos: ${a.credits}`}),a.rank&&e.jsx(i,{severity:"secondary",value:`Rango: ${a.rank.name}`}),a.role&&e.jsx(i,{severity:"secondary",value:`Rol: ${a.role.name}`})]})]})]})}),t.user_id&&e.jsx(x,{severity:"error",text:t.user_id,className:"mt-2"})]})]}),n===2&&c&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border dark:border-gray-600 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Cliente Seleccionado:"}),e.jsx("p",{className:"font-bold text-lg text-gray-800 dark:text-gray-100",children:c.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:c.email})]}),e.jsx(N,{icon:"pi pi-user-edit",label:"Cambiar",text:!0,plain:!0,onClick:j})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"1. Elige un paquete como punto de partida"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.map(a=>e.jsxs("div",{onClick:()=>F(a),className:`
                                                        p-4 border rounded-lg cursor-pointer transition-all duration-200 transform hover:shadow-lg
                                                        ${(s==null?void 0:s.id)===a.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/50 ring-2 ring-blue-500":"bg-white dark:bg-gray-700/50 border-gray-300 dark:border-gray-600"}
                                                    `,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-bold text-lg text-gray-800 dark:text-gray-200",children:a.name}),(s==null?void 0:s.id)===a.id&&e.jsx("i",{className:"pi pi-check-circle text-blue-500 text-xl"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Créditos: ",e.jsx("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:a.amount_credits})]})]},a.id))}),t.plan_package_id&&e.jsx(x,{severity:"error",text:t.plan_package_id,className:"mt-2"})]}),s&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-600 animate-fade-in",children:[e.jsx("h3",{className:"font-semibold text-gray-700 dark:text-gray-300",children:"2. Personaliza los detalles de la venta"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"credits",className:"mb-2 font-medium text-gray-600 dark:text-gray-400",children:"Créditos a Otorgar"}),e.jsx(B,{inputId:"credits",value:w.amount_credits,onValueChange:a=>o("amount_credits",a.value||0),mode:"decimal",min:0}),t.amount_credits&&e.jsx(x,{severity:"error",text:t.amount_credits,className:"mt-2 text-xs"})]})})]}),e.jsx("div",{className:"border-t dark:border-gray-600 pt-4 flex justify-end",children:e.jsx(N,{label:"Finalizar y Guardar Venta",icon:"pi pi-check",className:"w-full md:w-auto",onClick:D,loading:A,disabled:!s})})]})]})})}),e.jsx("div",{children:e.jsx(v,{className:"shadow-xl border border-gray-200 dark:border-gray-700 dark:bg-gray-800",title:e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:"Actividad Reciente (Última 10 ventas)"}),children:e.jsxs(G,{value:C,responsiveLayout:"scroll",className:"text-sm",paginator:!0,rows:5,children:[e.jsx(d,{header:"Cliente",body:a=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{label:a.cliente.charAt(0).toUpperCase(),shape:"circle"}),e.jsx("span",{className:"font-medium",children:a.cliente})]})}),e.jsx(d,{field:"paquete",header:"Paquete"}),e.jsx(d,{field:"credits",header:"Créditos"}),e.jsx(d,{header:"Rango",body:a=>e.jsx(i,{value:a.rank})}),e.jsx(d,{header:"Fecha",body:a=>I(a.fecha)})]})})})]})]})};export{J as default};
